{% extends "base.html" %}

{% block title %}Mes périodes école - TimeOff{% endblock %}
{% block page_title %}Mes périodes école{% endblock %}

{% block content %}
<div class="page-header-actions">
    <div class="filters">
        <select class="form-select" id="yearFilter" onchange="applyFilters()">
            {% for y in range(year_filter - 1, year_filter + 2) %}
            <option value="{{ y }}" {% if y == year_filter %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{{ url_for('employee.new_school_period') }}" class="btn btn-primary">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Ajouter une période
    </a>
</div>

<div class="info-banner mb-6">
    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    <p>Renseignez vos périodes à l'école pour qu'elles apparaissent dans le calendrier d'équipe et sur Slack.</p>
</div>

{% if periods %}
<div class="request-list">
    {% for period in periods %}
    <div class="request-card animate-slide-up" style="animation-delay: {{ loop.index * 0.05 }}s;">
        <div class="request-type-badge" style="background: #8B5CF620; color: #8B5CF6;">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
        </div>
        <div class="request-info">
            <div class="request-dates">
                {{ period.start_date.strftime('%d %b') }} → {{ period.end_date.strftime('%d %b %Y') }}
            </div>
            <div class="request-meta">
                {{ period.description or 'École' }} • {{ period.duration_days }} jour{{ 's' if period.duration_days > 1 else '' }}
            </div>
        </div>
        <div class="request-status">
            <span class="badge badge-purple">École</span>
            <div class="request-actions mt-2">
                <a href="{{ url_for('employee.edit_school_period', period_id=period.id) }}" class="btn btn-ghost btn-sm">
                    Modifier
                </a>
                <form action="{{ url_for('employee.delete_school_period', period_id=period.id) }}" method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-ghost btn-sm text-danger" onclick="return confirm('Supprimer cette période ?')">
                        Supprimer
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card-static">
    <div class="empty-state">
        <div class="empty-state-icon">
            <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
        </div>
        <h3 class="empty-state-title">Aucune période école</h3>
        <p class="empty-state-text">Ajoutez vos périodes à l'école pour qu'elles soient visibles par votre équipe.</p>
        <a href="{{ url_for('employee.new_school_period') }}" class="btn btn-primary">Ajouter une période</a>
    </div>
</div>
{% endif %}

<style>
.info-banner {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    background: var(--color-accent-light);
    border-radius: var(--radius-lg);
    color: var(--color-accent);
    font-size: var(--text-sm);
}

.info-banner svg {
    flex-shrink: 0;
}

.badge-purple {
    background: #8B5CF620;
    color: #8B5CF6;
}
</style>

<script>
function applyFilters() {
    const year = document.getElementById('yearFilter').value;
    window.location.href = `{{ url_for('employee.school_periods') }}?year=${year}`;
}
</script>
{% endblock %}
